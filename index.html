<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <!--<meta name="google-site-verification" content="DNRe_ZC-CBHA2fSTpcq0pMwP20j5hBW97mbQPDhoLb0" />-->
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <title> loading... </title>
    <link rel="stylesheet" href="css/index.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/SaltzmanAlaric/weekly@v1.0.14/lib/L2Dwidget.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/jquery/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/SaltzmanAlaric/weekly@v1.0.14/lib/jquery.bumpytext.packed.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/SaltzmanAlaric/weekly@v1.0.14/lib/easying.js"></script>
    <script>
        window.config = {
            organization: false,
            order: 'CREATED_AT',
            title: '一方通行',
            user: 'SaltzmanAlaric',
            repository: 'Mirror-blog',
            authors: 'SaltzmanAlaric',
            ignores: '1,2,3,4,5,7',
            host: '',
            hash: 'WTWUfeXEATcEPdACWEdXTEUEFUUOdFWEXdcfcFcE c2FsdHptYW5hbGFyaWMuZ2l0aHViLmlv',
            perpage: 10,
            aboutme: '#/posts/1',
            webSite: true,
            errorTitle: '恭喜达成404成就！',
            errorContent: '您访问的文章不存在哦，请认真核对网址。',
            comments: 'weekly',
            commentTitle: '留言',
            commentWrite: '我要发言',
            loadMore: '更多',
            listStyle: 'live type2',
            danmu: '<marquee scrollamount="10"><font color="#66CCFF">233&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<font size="3" color="#FF0000">前方高能</font></marquee><marquee scrollamount="6"><font size="2" color="#FF0000">第一</font>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;666</marquee><marquee scrollamount="8"><font ccolor="#006699">都是时辰的错</font>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<font  size="3" color="#EE0000">大哥喝阔落</font></marquee><marquee scrollamount="16"><font color="#006699">Wryyyyy</font>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;hhhhh</marquee><marquee scrollamount="14"><font color="#FF0000">战5渣</font>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;有人吗？？？</marquee><marquee scrollamount="12"><font size="3" color="#66CCFF">今天的风儿甚是喧嚣</font>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;666</marquee>',
            createYear: 2019,
        };

        const siblings = function() {
            let jump = "<div id='siblings' style='border-top: 1px solid #eaecef;margin-top:4px;padding-top: 0.3em;'></div>";
            let currHash = parseInt(document.location.hash.match(/[0-9]+/g)[0]);
            let pre = currHash + 1;
            let next = currHash - 1;
            const ignoresArr = window.config.ignores.split(',');
            if (ignoresArr && ignoresArr.length > 0) {
                let n = currHash;
                if (ignoresArr.includes(n)) {
                    return jump;
                }
                while(ignoresArr.includes((--n)+''));
                next = n;
                n = currHash;
                while(ignoresArr.includes((++n)+''));
                pre = n;
            }

            if (window.config.max) {
                if (pre <= window.config.max) {
                    jump += "<a style='float:left;background:#fff;border:0;margin:0px 0px 10px;' href='" + document.location.href.replace(/\/posts\/[0-9]+/g, "/posts/" + pre) + "'>◀ 上一篇</a>";
                }
                // hash从1开始
                if (next > 0) {
                    jump += "<a style='float:right;background:#fff;border:0;margin:0px 0px 10px;' href='" + document.location.href.replace(/\/posts\/[0-9]+/g, "/posts/" + next) + "'>下一篇 ▶</a>";
                }
            } else {
                $.ajax({
                    url:"https://api.github.com/repos/"+ window.config.user + "/" + window.config.repository + "/issues?page=1&per_page=1&assignee=" + window.config.user + "&sort=created-desc",
                    success:function(res) {
                        window.config.max = res[0].number;
                        if (pre <= window.config.max) {
                            jump += "<a style='float:left;background:#fff;border:0;margin:0px 0px 10px;' href='" + document.location.href.replace(/\/posts\/[0-9]+/g, "/posts/" + pre) + "'>◀ 上一篇</a>";
                        }
                        // hash从1开始
                        if (next > 0) {
                            jump += "<a style='float:right;background:#fff;border:0;margin:0px 0px 10px;' href='" + document.location.href.replace(/\/posts\/[0-9]+/g, "/posts/" + next) + "'>下一篇 ▶</a>";
                        }
                        return jump;
                    }
                });
            }
            return jump;
        };

        console.log('%c ' + window.config.title + ' ' + window.config.user,
            'font:italic bold 60px/100px arial,sans-serif;color:rgb(59, 183, 223);border-radius:20px;background:#eee;');

        const fmtDate = function () {
            let now = new Date();
            let month = now.getMonth() + 1;
            let date = now.getDate();
            let day = ["日", "一", "二", "三", "四", "五", "六"][now.getDay()];
            return now.getFullYear() + "年" + ("0" + month).slice(-2) + "月" + ("0" + date).slice(-2) + "日（星期" + day + "）";
        };

        const spendRate = function () {
            let now = new Date();
            let spendRate = (now.getTime() - new Date(now.getFullYear() + '-01-01 00:00:00').getTime()) / (new Date(now.getFullYear() + '-12-31 23:59:59').getTime() - new Date(now.getFullYear() + '-01-01 00:00:00').getTime());
            if (spendRate < 0.01) {
                spendRate = 0.01;
            } else if (spendRate > 99.99) {
                spendRate = 99.99;
            }
            return spendRate;
        };

        const getParams = function (key) {
            let params = window.location.search.split('?')[1];
            if (params) {
                let map = params.match("(^|&)" + key + "=([^&]*)");
                if (map) {
                    return decodeURI(map[2]);
                }
            }
            return null;
        };

        const openLabels = function (url) {
            let className = $("html").attr("class");
            let ele = document.getElementById("labels");
            if (!ele.innerHTML) {
                if (window.config.label_text === undefined) {
                    $("html").attr('class', 'loading');
                    fetch(url)
                        .then(res => res.json())
                        .then(data => {
                            window.config.label_text = "";
                            for(let i = 0, len = data.length; i < len; i++) {
                                window.config.label_text += '<a href="?label=' + data[i].name + '">#' + data[i].name + '</a>';
                            }
                            $("html").attr('class', className);
                            ele.innerHTML = window.config.label_text;
                        })
                        .catch(e => $("html").attr('class', className));
                } else {
                    ele.innerHTML = window.config.label_text;
                }
                window.config.labels = 1;
            } else {
                ele.style.display = window.config.labels === 1 ? "none" : "";
                window.config.labels = -window.config.labels;
            }
        };

        L2Dwidget.init({
            "model": {
                "jsonPath": "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
                "scale": 1
            },
            "display": {
                "superSample": 2,
                "width": 200,
                "height": 380,
                "position": "right",
                "hOffset": 0,
                "vOffset": 0
            },
            "mobile": {
                "show": false,
                "scale": 0.5
            },
            "react": {
                "opacityDefault": 0.7,
                "opacityOnHover": 0.2
            },
            "dialog": {
                // 开启对话框
                enable: true,
                script: {
                    // 每空闲 10 秒钟，显示一条一言
                    'every idle 10s': '$hitokoto$',
                    // 当触摸到星星图案
                    'hover .sitev': '点击💎可以播放音乐哦 (*/ω＼*)',
                    // 当触摸到角色身体
                    'tap body': '欢迎来到' + window.config.title + '的博客(*/ω＼*)',
                    // 当触摸到角色头部
                    'tap face': '今天是' + fmtDate() + '，今年已经过去' + (spendRate() * 100).toFixed(2) + '%了。'
                }
            }
        });

        // 返回上一页
        const goBack = function () {
            let isHome = !!$(".page-current #user")[0];
            if (isHome) {
                return false;
            }
            !!$(".page #user")[0].innerText ? window.history.back() : window.location.hash = "#/";
        };

        // 一年进度条
        var timeBar = function () {
            let c = document.getElementById("timeProcess");
            let ctx = c.getContext("2d");
            let circ = Math.PI * 2;
            let quart = Math.PI / 2;
            let myCanvas_rect = c.getBoundingClientRect();
            let widths = myCanvas_rect.width;
            let heights = myCanvas_rect.height;

            $("#timeProcess").css({left: (($("#user").width() - widths) / 2 + 20) + "px"});
            // 清除画布
            ctx.clearRect(0, 0, c.width, c.height);
            ctx.beginPath();
            ctx.strokeStyle = '#FF4500';
            ctx.lineCap = 'square';
            ctx.closePath();
            ctx.fill();
            ctx.lineWidth = 2.0;

            let imd = ctx.getImageData(0, 0, widths, heights);

            function draw(current) {
                ctx.putImageData(imd, 0, 0);
                ctx.beginPath();
                ctx.arc((widths < 90 ? widths + 26 : widths) / 2, (heights < 90 ? heights + 26 : heights) / 2, (heights < 90 ? heights + 24 : heights) / 2 - 2, -(quart), ((circ) * current) - quart, false);
                ctx.stroke();
            }

            const loadCanvas = function (now) {
                if (window.config.timeBar === undefined) {
                    let t = 0, timer = null;
                    timer = setInterval(function () {
                        if (t > now) {
                            draw(now);//最后一次绘制
                            clearInterval(timer);
                        } else {
                            draw(t);
                            t += 0.01;
                        }
                    }, 20);
                    window.config.timeBar = true;
                    timer= null;
                } else {
                    draw(now);
                }
            };
            loadCanvas(spendRate());
        };

    </script>
</head>
<body>
<div id="bar"></div>
<div class="page home">
    <div>
        <div id="user"></div>
        <div id="posts"></div>
    </div>
</div>
<div class="page single">
    <div>
        <div id="post"></div>
        <div id="comments"></div>
    </div>
</div>
<div id="loader">
    <div></div>
</div>
<audio id="audio" controls="controls" autoplay="autoplay" hidden="hidden"></audio><!--
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/SaltzmanAlaric/weekly@v1.0.14/lib/index.04eb6053.js"></script>-->
<script type="text/javascript" src="lib/index.04eb6053.js"></script>
<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="sitev">
    <div id="musicBtn">💎</div>
    <span id="busuanzi_value_site_pv"></span>次/<span id="busuanzi_value_site_uv"></span>人
</div>
<div class="kotori-show"><img src="https://cdn.jsdelivr.net/gh/SaltzmanAlaric/weekly@v1.0.14/static/images/kotori.png" alt="抢镜脸" onclick="goBack()"/>
</div>
<script src="js/index.js"></script>
</body>
</html>